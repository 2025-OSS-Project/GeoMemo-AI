name: ğŸ“¨ Discord Issue & PR ì•Œë¦¼ (ì„ë² ë“œ ë²„ì „)

on:
  issues:
    types: [opened, closed, reopened, edited]
  pull_request:
    types: [opened, closed, reopened, synchronize]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
    # 1) ë ˆí¬ì§€í† ë¦¬ë³„ ì›¹í›… ì„ íƒ
    - name: Select Discord webhook
      id: hook
      run: |
        case "${GITHUB_REPOSITORY}" in
          2025-OSS-Project/GeoMemo-Backend)  echo "url=${{ secrets.WEBHOOK_BACKEND }}"  >> $GITHUB_OUTPUT ;;
          2025-OSS-Project/GeoMemo-Frontend) echo "url=${{ secrets.WEBHOOK_FRONTEND }}" >> $GITHUB_OUTPUT ;;
          2025-OSS-Project/GeoMemo-AI)       echo "url=${{ secrets.WEBHOOK_AI }}"       >> $GITHUB_OUTPUT ;;
          *) echo "::error::ì•Œ ìˆ˜ ì—†ëŠ” ë ˆí¬ì§€í† ë¦¬"; exit 1 ;;
        esac

    # 2-A) Issue ì•Œë¦¼ â”€ ì—´ë¦°/ë‹«í˜/ìˆ˜ì • ë³„ ìƒ‰ìƒÂ·ë©”ì‹œì§€
    - name: Issue event â†’ Discord
      if: github.event_name == 'issues'
      uses: sarisia/actions-status-discord@v1  # JS ì•¡ì…˜, embed ì§€ì› :contentReference[oaicite:2]{index=2}
      with:
        webhook: ${{ steps.hook.outputs.url }}
        username: Issue Bot ğŸ›
        avatar_url: https://raw.githubusercontent.com/github/explore/main/topics/github-actions/github-actions.png
        color: ${{ github.event.action == 'opened' && '0x00B0F4' || github.event.action == 'closed' && '0x808080' || '0xF4D742' }}
        title: |
          ğŸ› Issue #${{ github.event.issue.number }} ${{ github.event.action }}
        url: ${{ github.event.issue.html_url }}
        description: |
          **${{ github.event.issue.title }}**
          â†³ ì‘ì„±ì: <https://github.com/${{ github.event.issue.user.login }}>
          â†³ ë ˆì´ë¸”: ${{ join(github.event.issue.labels.*.name, ', ') }}
          â†³ ìƒíƒœ: ${{ github.event.issue.state }}

    # 2-B) PR ì•Œë¦¼ â”€ ë¨¸ì§€/ì—´ë¦¼/ë™ê¸°í™” ë³„ ìƒ‰ìƒÂ·í•„ë“œ
    - name: Pull-Request event â†’ Discord
      if: github.event_name == 'pull_request'
      uses: sarisia/actions-status-discord@v1
      with:
        webhook: ${{ steps.hook.outputs.url }}
        username: PR Bot ğŸš€
        color: ${{ github.event.action == 'closed' && github.event.pull_request.merged == true && '0x57F287' || github.event.action == 'opened' && '0xF47FFF' || '0xFAA61A' }}
        title: |
          ğŸš€ PR #${{ github.event.pull_request.number }} ${{ github.event.action }}
        url: ${{ github.event.pull_request.html_url }}
        description: |
          **${{ github.event.pull_request.title }}**
          â†³ ì‘ì„±ì: <https://github.com/${{ github.event.pull_request.user.login }}>
          â†³ ë¸Œëœì¹˜: `${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}`
          â†³ ì»¤ë°‹: ${{ github.event.pull_request.commits }}
          â†³ ë³€ê²½ íŒŒì¼: ${{ github.event.pull_request.changed_files }}
